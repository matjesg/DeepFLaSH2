---

title: Utility functions


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions for deepflash2"
description: "Utility functions for deepflash2"
nb_path: "nbs/06_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Download-and-Archive-Extraction">Data Download and Archive Extraction<a class="anchor-link" href="#Data-Download-and-Archive-Extraction"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="unzip" class="doc_header"><code>unzip</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>unzip</code>(<strong><code>path</code></strong>, <strong><code>zip_file</code></strong>)</p>
</blockquote>
<p>Unzip and structure archive</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_sample_data" class="doc_header"><code>download_sample_data</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_sample_data</code>(<strong><code>base_url</code></strong>, <strong><code>name</code></strong>, <strong><code>dest</code></strong>, <strong><code>extract</code></strong>=<em><code>False</code></em>, <strong><code>timeout</code></strong>=<em><code>4</code></em>, <strong><code>show_progress</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install-packages-on-demand">Install packages on demand<a class="anchor-link" href="#Install-packages-on-demand"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="install_package" class="doc_header"><code>install_package</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>install_package</code>(<strong><code>package</code></strong>, <strong><code>version</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="import_package" class="doc_header"><code>import_package</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>import_package</code>(<strong><code>package</code></strong>, <strong><code>version</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compose_albumentations" class="doc_header"><code>compose_albumentations</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compose_albumentations</code>(<strong><code>gamma_limit_lower</code></strong>=<em><code>0</code></em>, <strong><code>gamma_limit_upper</code></strong>=<em><code>0</code></em>, <strong><code>CLAHE_clip_limit</code></strong>=<em><code>0.0</code></em>, <strong><code>brightness_limit</code></strong>=<em><code>0</code></em>, <strong><code>contrast_limit</code></strong>=<em><code>0.0</code></em>, <strong><code>distort_limit</code></strong>=<em><code>0.0</code></em>)</p>
</blockquote>
<p>Compose albumentations augmentations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-functions">Plotting functions<a class="anchor-link" href="#Plotting-functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_show" class="doc_header"><code>clean_show</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L92" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_show</code>(<strong><code>ax</code></strong>, <strong><code>msk</code></strong>, <strong><code>title</code></strong>, <strong><code>cmap</code></strong>, <strong><code>cbar</code></strong>=<em><code>None</code></em>, <strong><code>ticks</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_results" class="doc_header"><code>plot_results</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_results</code>(<strong>*<code>args</code></strong>, <strong><code>df</code></strong>, <strong><code>hastarget</code></strong>=<em><code>False</code></em>, <strong><code>num_classes</code></strong>=<em><code>2</code></em>, <strong><code>model</code></strong>=<em><code>None</code></em>, <strong><code>instance_labels</code></strong>=<em><code>False</code></em>, <strong><code>metric_name</code></strong>=<em><code>'dice_score'</code></em>, <strong><code>unc_metric</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(20, 20)</code></em>, <strong><code>msk_cmap</code></strong>=<em><code>'viridis'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Plot images, (masks), predictions and uncertainties side-by-side.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Patch-to-show-metrics-in-Learner">Patch to show metrics in Learner<a class="anchor-link" href="#Patch-to-show-metrics-in-Learner"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Recorder.plot_metrics" class="doc_header"><code>Recorder.plot_metrics</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Recorder.plot_metrics</code>(<strong><code>nrows</code></strong>=<em><code>None</code></em>, <strong><code>ncols</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>None</code></em>, <strong><code>sharex</code></strong>=<em><code>False</code></em>, <strong><code>sharey</code></strong>=<em><code>False</code></em>, <strong><code>squeeze</code></strong>=<em><code>True</code></em>, <strong><code>width_ratios</code></strong>=<em><code>None</code></em>, <strong><code>height_ratios</code></strong>=<em><code>None</code></em>, <strong><code>subplot_kw</code></strong>=<em><code>None</code></em>, <strong><code>gridspec_kw</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pixelwise-Analysis">Pixelwise Analysis<a class="anchor-link" href="#Pixelwise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="multiclass_dice_score" class="doc_header"><code>multiclass_dice_score</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L187" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>multiclass_dice_score</code>(<strong><code>y_true</code></strong>, <strong><code>y_pred</code></strong>, <strong><code>average</code></strong>=<em><code>'macro'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes the Sørensen–Dice coefficient for multiclass segmentations.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="binary_dice_score" class="doc_header"><code>binary_dice_score</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L210" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>binary_dice_score</code>(<strong><code>y_true</code></strong>, <strong><code>y_pred</code></strong>)</p>
</blockquote>
<p>Compute the Sørensen–Dice coefficient for binary segmentations.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dice_score" class="doc_header"><code>dice_score</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L217" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dice_score</code>(<strong><code>y_true</code></strong>, <strong><code>y_pred</code></strong>, <strong><code>average</code></strong>=<em><code>'macro'</code></em>, <strong><code>num_classes</code></strong>=<em><code>2</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes the Sørensen–Dice coefficient.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">dice_score</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dice_score</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Todo: add multiclass tests https://scikit-learn.org/stable/modules/generated/sklearn.metrics.jaccard_score.html</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ROI-wise-Analysis">ROI-wise Analysis<a class="anchor-link" href="#ROI-wise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="label_mask" class="doc_header"><code>label_mask</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L230" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>label_mask</code>(<strong><code>mask</code></strong>, <strong><code>threshold</code></strong>=<em><code>0.5</code></em>, <strong><code>connectivity</code></strong>=<em><code>4</code></em>, <strong><code>min_pixel</code></strong>=<em><code>0</code></em>, <strong><code>do_watershed</code></strong>=<em><code>False</code></em>, <strong><code>exclude_border</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Analyze regions and return labels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_a</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_b</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_instance_segmentation_metrics" class="doc_header"><code>get_instance_segmentation_metrics</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L269" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_instance_segmentation_metrics</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>is_binary</code></strong>=<em><code>False</code></em>, <strong><code>thresholds</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes instance segmentation metric based on cellpose/stardist implementation.
<a href="https://cellpose.readthedocs.io/en/latest/api.html#cellpose.metrics.average_precision">https://cellpose.readthedocs.io/en/latest/api.html#cellpose.metrics.average_precision</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ap</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">get_instance_segmentation_metrics</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ap</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">get_instance_segmentation_metrics</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2022-06-08 12:01:32,630 [INFO] WRITING LOG OUTPUT TO /home/magr/.cellpose/run.log
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ROI-Export-to-ImageJ">ROI Export to ImageJ<a class="anchor-link" href="#ROI-Export-to-ImageJ"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="export_roi_set" class="doc_header"><code>export_roi_set</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L294" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>export_roi_set</code>(<strong><code>mask</code></strong>, <strong><code>intensity_image</code></strong>=<em><code>None</code></em>, <strong><code>instance_labels</code></strong>=<em><code>False</code></em>, <strong><code>name</code></strong>=<em><code>'RoiSet'</code></em>, <strong><code>path</code></strong>=<em><code>Path('.')</code></em>, <strong><code>ascending</code></strong>=<em><code>True</code></em>, <strong><code>min_pixel</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>EXPERIMENTAL: Export mask regions to imageJ ROI Set</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">export_roi_set</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Miscellaneous">Miscellaneous<a class="anchor-link" href="#Miscellaneous"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_iterations" class="doc_header"><code>calc_iterations</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L325" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_iterations</code>(<strong><code>n_iter</code></strong>, <strong><code>ds_length</code></strong>, <strong><code>bs</code></strong>)</p>
</blockquote>
<p>Calculate the number of required epochs for 'n_iter' iterations.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">calc_iterations</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_label_fn" class="doc_header"><code>get_label_fn</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L331" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_label_fn</code>(<strong><code>img_path</code></strong>, <strong><code>msk_dir_path</code></strong>)</p>
</blockquote>
<p>Infers suffix from mask name and return label_fn</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_mask" class="doc_header"><code>save_mask</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L338" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_mask</code>(<strong><code>mask</code></strong>, <strong><code>path</code></strong>, <strong><code>filetype</code></strong>=<em><code>'.png'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">mask</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">imageio</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">filetype</span><span class="p">),</span> <span class="n">mask</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_unc" class="doc_header"><code>save_unc</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L343" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_unc</code>(<strong><code>unc</code></strong>, <strong><code>path</code></strong>, <strong><code>filetype</code></strong>=<em><code>'.png'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_unc</span><span class="p">(</span><span class="n">unc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">):</span>
    <span class="n">unc</span> <span class="o">=</span> <span class="p">(</span><span class="n">unc</span><span class="o">/</span><span class="n">unc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">imageio</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">filetype</span><span class="p">),</span> <span class="n">unc</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

